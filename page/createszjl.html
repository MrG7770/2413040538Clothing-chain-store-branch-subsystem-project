<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>新增收支记录</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
  <link rel="stylesheet" href="../css/layuimini.css" media="all">
</head>
<body class="layui-form">
  <div class="layui-card">
    <div class="layui-card-body" style="padding: 15px;">
      <form class="layui-form" lay-filter="financialForm">
        <input type="hidden" name="recordId">
        
        <div class="layui-form-item">
          <label class="layui-form-label required">收支类型</label>
          <div class="layui-input-block">
            <select name="type" lay-verify="required" lay-filter="typeFilter">
              <option value="">请选择收支类型</option>
              <option value="收入">收入</option>
              <option value="支出">支出</option>
            </select>
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label required">交易类型</label>
          <div class="layui-input-block">
            <select name="transactionType" lay-verify="required">
              <option value="">请选择交易类型</option>
              <option value="销售服装">销售服装</option>
              <option value="进货成本">进货成本</option>
              <option value="店面租金">店面租金</option>
              <option value="水电费">水电费</option>
              <option value="员工工资">员工工资</option>
              <option value="其他收入">其他收入</option>
              <option value="其他支出">其他支出</option>
            </select>
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label required">金额(元)</label>
          <div class="layui-input-block">
            <input type="number" step="0.01" min="0.01" name="amount" lay-verify="required|number" placeholder="请输入金额" autocomplete="off" class="layui-input">
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label required">交易日期</label>
          <div class="layui-input-block">
            <input type="text" name="date" lay-verify="required" placeholder="请选择交易日期" autocomplete="off" class="layui-input" id="date">
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label required">支付方式</label>
          <div class="layui-input-block">
            <select name="paymentMethod" lay-verify="required">
              <option value="">请选择支付方式</option>
              <option value="现金">现金</option>
              <option value="微信支付">微信支付</option>
              <option value="支付宝">支付宝</option>
              <option value="银行转账">银行转账</option>
              <option value="银行代扣">银行代扣</option>
              <option value="其他">其他</option>
            </select>
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label required">经手人</label>
          <div class="layui-input-block">
            <input type="text" name="handler" lay-verify="required" placeholder="请输入经手人姓名" autocomplete="off" class="layui-input">
          </div>
        </div>
        
        <div class="layui-form-item">
          <label class="layui-form-label">备注</label>
          <div class="layui-input-block">
            <textarea name="remark" placeholder="请输入备注信息" class="layui-textarea"></textarea>
          </div>
        </div>
        
        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="submitForm">保存</button>
            <button type="button" class="layui-btn layui-btn-primary" id="cancelBtn">取消</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
  <script>
    layui.use(['form', 'layer', 'laydate'], function () {
      var form = layui.form;
      var layer = layui.layer;
      var laydate = layui.laydate;
      var $ = layui.$;
      
      // 渲染日期选择器
      laydate.render({
        elem: '#date',
        format: 'yyyy-MM-dd',
        value: new Date() // 默认当前日期
      });
      
      // 收支类型选择事件，自动调整交易类型选项
      form.on('select(typeFilter)', function(data){
        var type = data.value;
        var transactionSelect = $("select[name='transactionType']");
        
        // 清空并添加默认选项
        transactionSelect.html('<option value="">请选择交易类型</option>');
        
        // 根据收支类型添加对应交易类型选项
        if(type === '收入') {
          transactionSelect.append('<option value="销售服装">销售服装</option>');
          transactionSelect.append('<option value="其他收入">其他收入</option>');
        } else if(type === '支出') {
          transactionSelect.append('<option value="进货成本">进货成本</option>');
          transactionSelect.append('<option value="店面租金">店面租金</option>');
          transactionSelect.append('<option value="水电费">水电费</option>');
          transactionSelect.append('<option value="员工工资">员工工资</option>');
          transactionSelect.append('<option value="其他支出">其他支出</option>');
        }
        
        // 重新渲染表单
        form.render('select');
      });
      
      // 生成唯一记录ID
      function generateRecordId() {
        var date = new Date();
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        var day = date.getDate().toString().padStart(2, '0');
        var random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        return 'FIN' + year + month + day + random;
      }
      
      // 表单提交
      form.on('submit(submitForm)', function (data) {
        // 生成记录ID
        data.field.recordId = generateRecordId();
        
        // 在实际应用中，这里应该发送AJAX请求到后端保存数据
        console.log('新增收支记录:', data.field);
        
        // 显示保存成功提示
        layer.msg('收支记录添加成功', {
          icon: 1,
          time: 1500
        }, function () {
          // 关闭当前弹窗，并刷新父页面表格
          var index = parent.layer.getFrameIndex(window.name);
          parent.layer.close(index);
          parent.layui.table.reload('financialTable');
        });
        
        return false;
      });
      
      // 取消按钮
      $('#cancelBtn').click(function () {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
      });
    });
  </script>
</body>
</html>
    